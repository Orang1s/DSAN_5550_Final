## Predicting Urban Air Quality from Weather and Traffic Patterns

**Author**: Xiaolong Zhou  
**Course**: DSAN 5550 

---

### Overview

This project investigates whether **local vehicular traffic** meaningfully improves prediction of **next‑day PM2.5 Air Quality Index (AQI)** in New York City, when combined with **weather variables**.  

---

### Data Sources

- **Traffic (NYC Open Data)**  
  - Automated Traffic Volume Counts for NYC.
  - Aggregated to **daily city‑wide traffic volume** (`Traffic_Vol`).

- **Air Quality (EPA AirData)**  
  - Daily PM2.5 AQI for NYC monitoring sites (2021–2023).  
  - Averaged across sites to obtain a **city‑level daily AQI**.

- **Weather (Meteostat / NOAA)**  
  - Central Park station (lat 40.785091, lon −73.968285).  
  - Daily variables: `Temp_Avg`, `Precipitation`, `Wind_Speed`, `Pressure`.

All three sources are merged by date to create a modeling table.

---

### Repository Structure

- `Final_5550.ipynb`  
  Main notebook with full pipeline: data, feature engineering, modeling, evaluation, SHAP analysis, and carbon accounting.

- `Final_checkin.ipynb`  
  Earlier intermediate version used for the course check‑in.

- `final_model_data.csv`  
  Pre‑processed modeling dataset with merged traffic, weather, and AQI features.

- `emissions.csv`  
  Output file generated by `codecarbon` with estimated carbon emissions for the notebook run.

- `correlation_matrix.png`, `final_comparison_plot.png`  
  Key figures used in the poster and paper.
  
- All source data is in data folder, nyc_traffic data is compressed for git. This project is csv-centered instead of using API, because it is more stable.

---

### Methods

#### Feature Engineering

Key features include:

- **Traffic_Vol**: Daily aggregated traffic volume (NYC ATR counts).
- **Wind_Speed, Precipitation, Pressure, Temp_Avg**: Raw weather variables.
- **Traffic_Index**: `Traffic_Vol / (Wind_Speed + 0.1)`: approximates when low ventilation (little wind) with high traffic which traps air pollutant.
- **Temp_Change**: `Temp_Avg_today − Temp_Avg_yesterday`.
- **AQI, AQI_Lag_1, AQI_Roll_3**: Today’s AQI, yesterday’s AQI, and 3‑day rolling AQI.
- **Target_NextDay_AQI**: Tomorrow’s AQI (prediction target).

Days with **AQI > 150** are treated as extreme outliers and removed for the main analysis.

#### Models

1. **Linear Regression:** To establish a baseline and test for linear relationships.

2. **XGBoost Regressor:** To capture potential non-linear interactions between weather and traffic.

---

### Conclusion & Future Work

### Key Findings
1. **Traffic is a Weak Predictor:** Suprisingly, different from the initial hypothesis, local traffic volume showed negligible correlation ($r \approx -0.02$) with daily AQI fluctuations. Even when I engineered a physics-based **Traffic Index** (combining Traffic and Wind), the model assigned it near-zero importance (SHAP analysis), confirming that local vehicle emissions are not the primary driver of daily AQI variance in this dataset.

2.  **Weather stays strong as predictor:** The SHAP analysis revealed that **Precipitation**, **Wind Speed**, and **Pressure** were the strongest predictors.
    *   **Precipitation:** showed a strong cleansing effect (negative correlation), it can effectively wash out the pollution.
    *   **Pressure:** High pressure proved to be a strong indicator of accumulation (stagnation), while high wind speeds acted as the primary dispersion mechanism.

3. **Model Performance:** While the low $R^2$ indicates difficulty in predicting the exact magnitude, but the model achieved a relatively good **Directional Accuracy**. It successfully captures the trend of air quality, making it a viable tool for directional early warning systems.

### Limitations & Future Work
A key limitation was the data source itself. I aggregated traffic for the entire city but compared it to specific AQI sensors. A traffic jam in Queens may not affect a sensor in Manhattan. 
 - Future Work: This should be improved by using Geospatial Matching, using specific traffic counters with the nearest air quality monitor.

The model relies solely on ground-level sensors. It fails to account for pollution like smoke from other states. 
 - Future Work: Incorporate other data to differentiate between locally generated pollution and regional transport.

NYC is a dense, transit-heavy island with unique weather. The findings that 'traffic is negligible' may not hold for car-centric cities like Los Angeles, however, due to the obstacle in finding other valid city data, this project sticks with NYC only.
 - Future Work: Replicate the study across diverse urban topologies to test generalizability.

### Environmental Impact:
The computational cost of this project was tracked using the CodeCarbon library. The total emissions for the data processing and model training pipeline were approximately 0.11 grams of CO2 (0.000108 kg). And the run lasts only 23 seconds. This low footprint is attributed to the efficiency of the Apple M4 silicon and the use of pre-aggregated datasets.

---
